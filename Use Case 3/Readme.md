## Use case 3. Anomaly detection and root cause analysis 


This folder contains the code and data to run the anomaly detection and Root Cause Analysis (RCA) example.

**Dataset**. *ex_10m_spike_30s_10-150_DT.csv*. This is the dataset used as illustrative example for this use case. It is derived by running a workload, as described below, on a well-known open-source benchmark for microservice  architecture (MSA), named Train Ticket [1].  The application simulates a train ticket booking system, composed of 41 microservices communicating to each other via REST over HTTP. Train ticket is  polyglot (e.g., Java, golang, Node.js, etc). 

The dataset has the following columns: |Container1 CPU usage| ... |ContainerN CPU usage|Container1 Memory usage| ... |ContainerN Memory usage|

Each row is a sample every 5 seconds.

**Workload generation**. The dataset is generated by stressing the system with a workload. The folder contains the files/scripts to: i) gather monitoring data, ii) parse the raw monitoring data and creating the dataset. The "locust.py" file customize the tool Locust [2], which we exploited to generate the load.  Locust is a distributed, open-source load testing tool that simulates concurrent users in an application for each benchmark. We customize the workload to reflect the behavior of real users. In total, we run on average 8 requests per second for 10 minutes, with 10 users. The run configuration models a "spike" in which the load is increased to 150 users after 5 minutes for 30 seconds in order to see if any anomaly is detected. 

<!-- - **Monitoring data**. The folder contains raw data gathered by monitoring. This includes: containers CPU usage, containers Memory usage, containers Network usage. Monitoring data are collected by DockerStats run in each container. 

*Benchmark.txt*. The file contains a link to the MSA under analysis.   -->
 

**Code**. To run anomaly detection on all microservices data, run the *anomaly.R* script, as described below; then, if any anomlay is detected, you can run the *MuTE.py* script to diagnose the possible root cause by assessing any temporal cause-effect relation between microservices (CPU and memory). 

*Prerequisites*: 

Python (version >3), JVM/JRE (version > 1.8), Locust (used with version 2.8.6). 

Libraries: Anomalize (R code, https://cran.r-project.org/web/packages/anomalize/)  IDTxl (https://github.com/pwollstadt/IDTxl)

For IDTxl, follow the instructions at https://github.com/pwollstadt/IDTxl/wiki/Installation-and-Requirements to install it. 

*Commands*: 
> ./anomaly.R <dataset_filename>.csv         #for anomaly detection, output a jpg image

> ./MuTE.py   <dataset_filename>.csv   	     #for modelling relation between microservices and the anomaly
 
The example dataset file is *ex_10m_spike_30s_10-150_DT.csv* located in the "Use Case 3/dataset" folder.

**Results**. The anomlay detection script generates  the graphical representation of possible anomalies detected in any container-level metric;  the result of Multivariate Transfer Entropy (MuTE) applied to the same series. The MuTE output are both in textaul form and as a graph (i.e., the network) representing which time series transfer more entropy to which other and at which significance. Given a target microservice that experienced anomalies (in CPU or memory data) and for which you want to diagnose the root cause, the graph tells which other microservice is more likely the cause of the anomaly (i.e., which transfer more entropy, and the corresponding time lag between the time series that maximize the transfer).  



