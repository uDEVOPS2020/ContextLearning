
## Use case 2. Characterizing causal-effect releations betweeen microservices in an MSA. 

This folder contains: 
- **Dataset**. This is the dataset used as illustrative example for this use case. It is derived by running a load on a well-known open-source benchmark for microservice  architecture (MSA), named Train Ticket [1].  The application simulates a train ticket booking system, composed of 41 microservices communicating to each other via REST over HTTP. Train ticket is  polyglot (e.g., Java, golang, Node.js, etc). 

Dataset has the following columns: 

| Reponse Time median MS1 | ... | Response Time median MSn | Reponse Time avg MS1 | ... | Response Time avg MSn |

Each row is a sample every 5 seconds. 

- **Workload generation**. The dataset are generated by stressing the system with a workload. The folder contains the files to use and customise the tool Locust [2], which we exploited to generate the load. Locust is a distributed, open-source load testing tool that simulates concurrent users in an application for each benchmark. We customize the workload to reflect the behavior of real users. In total, we run on average 8 requests per second for 10 minutes, with 10 active users.  

<!-- - **Monitoring data**. The folder contains raw data gathered by monitoring. 
This includes for each request: a flag indicating if the request conform to a valid/invalid user behaviour, response time, response HTTP status code, and the microservice to which the request is sent.
Monitoring data are collected by Locust. 

- *Benchmark.txt*. The file contains a link to the MSA under analysis.  
 -->
- **Results**. It contains the results of applying the causal model to the dataset. The results are both in the form of Causal Graph (a Directed Acyiclic Graph - DAG) and in a textual form, both representing the relations between microservices in terms of response times (which response time is likely to cause any other). The types of relations (with the associated probability) can be: 
- A --> B. A is a cause of B. It may be a direct or indirect cause that may include other measured variables. Also, there may be an unmeasured confounder of A and B. It also implies that B is not a cause of A. 
- A <-> B. There is an unmeasured confounder (call it L) of A and B. There may be measured variables along the causal pathway from L to A or from L to B.
It is also implied taht A is not a cause of B and B is not a cause of A. 
- A o-> B. Either A is a cause of B (i.e, A --> B) or there is an unmeasured confounder of A and B (i.e, A <-> B) or both. It implies that B is not a cause of A.
- A o-o B. Exactly one of the following holds: A is a cause of B; B is a cause of A; there is an unmeasured confounder of A and B; both a and c; both b and c. 

Moreover, in the SEM folder, you will find the Structural Equation Model corresponding to the graph: they express, for any cause-effect pair, how much of the effect is explained by a unit variation of the cause. This allows discovering the relations between microservices, in terms of response time, useful for design and testing. 

- **Code**. Python code files/scripts to: i) gather monitoring data, ii) parse the raw monitoring data and creating the dataset, iii) read the dataset and apply the algorithms for causal structure discovery to create a causal model (both as a notebook and as .py file), iv) compute and output the SEM model. 

To reproduce:  use the code files from steps iii) to iv). 

*Prerequisites*: 

Python (version >3), JVM/JRE (version > 1.8), Locust (tested with version 2.8.6). 

Libraries: 

py_causal (https://github.com/bd2kccd/py-causal). This is directly cloned in the code, there's no need to clone and load it. 

tetrad-gui-7.1.0-launch.jar (add this library to the build when running Sem.java) - the library is from Tetrad (https://www.tetradcausal.app/). 

*Commands*: 

>  You can run the "*MSA_causal_model.ipynb*" notebook

>  You can run the java code, once added the tetrad library to the build path: *java Sem.java <path-to-file/filename>.csv*
 
An example dataset file you can use is "MSA_medians_RT.csv" located in the "Use Case 2/dataset" folder, which is the same suggested in the MSA_causal_model notebook 

To replicate on a different subject, use Locust and monitoring scripts on the new subject, thus apply all the steps i) to iv). Replace the input dataset filenames in the two files above. 
